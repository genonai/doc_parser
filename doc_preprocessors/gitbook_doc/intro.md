# Genos 지능형 전처리기

## 🎯 왜 RAG 시스템에 지능형 전처리기가 필요한가?

### 문제 상황: 원본 문서의 복잡성

기업의 실제 문서들은 단순한 텍스트 파일이 아닙니다. 아래 예시 문서와 같이 복잡한 레이아웃, 표, 그래프, 다단 구성 등 다양한 형식을 포함합니다.

![복잡한 문서 예시](./images/document_complexity.png)
*실제 문서의 복잡한 구조: 다단 레이아웃, 표, 차트, 각주 등이 혼재*

**지능형 전처리 없이 RAG를 수행한다면:**
- 📊 표의 구조가 깨져 의미를 잃음
- 📝 제목과 본문이 구분되지 않아 맥락 파악 불가
- 🖼️ 이미지 캡션이 분리되어 정보 손실
- 📑 다단 구성이 뒤섞여 문장이 엉킴

### 해결책: 지능형 문서 전처리

Genos 전처리기는 문서의 구조를 이해하고, RAG가 효과적으로 작동할 수 있도록 데이터를 준비합니다.

## 🔍 전처리기의 핵심 기능

### 1. Layout Detection - 문서 구조 이해

![Layout Detection 결과](./images/layout_detection_example.png)
*AI 모델이 문서의 각 요소를 자동으로 식별 - TITLE, SECTION_HEADER, TEXT, TABLE, PICTURE 등*

**Layout Detection이 식별하는 요소들:**
- **제목(Title)**: 문서의 주제를 나타내는 핵심 텍스트
- **섹션 헤더**: 문서의 계층 구조를 형성하는 소제목들
- **본문 텍스트**: 실제 내용을 담고 있는 단락들
- **표(Table)**: 정형 데이터를 담은 격자 구조
- **그림(Picture)**: 차트, 다이어그램, 사진 등의 시각 자료
- **캡션**: 표나 그림을 설명하는 텍스트

### 2. TableFormer - 표 구조 완벽 복원

![TableFormer 처리 결과](./images/tableformer_result.png)
*복잡한 표를 정확하게 구조화된 데이터로 변환 - 병합 셀, 계층적 헤더를 Markdown으로 구조화*

**TableFormer의 장점:**
- 병합된 셀 정확한 인식
- 계층적 헤더 구조 보존
- 숫자/텍스트 데이터 타입 구분
- 표 내 각주 및 설명 연결

### 3. 지능형 청킹 - 의미 단위로 분할

**왜 청킹이 중요한가?**

LLM은 한 번에 처리할 수 있는 텍스트 길이에 제한이 있습니다. 예로, 500페이지 문서를 통째로 넣을 수 없기 때문에, 문서를 작은 조각으로 나누어야 합니다. 하지만 단순히 글자 수로 자르면:
- ❌ 문장이 중간에 잘려 의미가 손상됨
- ❌ 표가 분리되어 데이터 관계가 깨짐
- ❌ 섹션 정보가 사라져 맥락을 잃음

**Genos 청킹 시나리오:**

#### 시나리오 1: 회사 규정 문서 (100페이지)

**원본 문서 구조:**
```
📄 인사 규정
├─ 제1장 총칙 (2페이지)
├─ 제2장 채용 (15페이지)
│  ├─ 2.1 채용 절차
│  ├─ 2.2 채용 기준표 [대형 표]
│  └─ 2.3 서류 양식
└─ 제3장 근태관리 (20페이지)
```

**청킹 결과:**
- **청크 1**: "제1장 총칙" 전체 (작은 섹션이라 하나로)
- **청크 2**: "2.1 채용 절차" 텍스트
- **청크 3**: "2.2 채용 기준표" (표 전체를 하나로 보존)
- **청크 4**: "2.3 서류 양식"

💡 **포인트**: 각 청크가 상위 섹션의 헤더 정보를 포함하여 "인사 규정 > 제2장 채용 > 2.1 채용 절차" 같은 완전한 문맥 경로 유지

#### 시나리오 2: 기술 매뉴얼의 복잡한 표

**상황**: API 명세서에 500개 엔드포인트를 정리한 거대한 표

```
| 엔드포인트 | 메소드 | 파라미터 | 응답 | 설명 |
|-----------|--------|---------|------|------|
| /user/login | POST | id, pw | token | ... |
| ... 498개 더 ... |
```

**일반 청킹**: 표가 100개씩 5개 청크로 쪼개짐 → 검색 시 불완전한 정보
**Genos 청킹**:
- 표 전체를 한 청크에 처리 (청크 생성 상한인 2,000 토큰보다 큰 4,096 토큰까지 허용)
- 표를 Markdown 또는 HTML 형식으로 구조를 유지하며 변환
- 하나의 독립 청크로 보존 → 검색 시 완전한 표 정보 제공

#### 시나리오 3: 다단계 섹션의 연구 보고서

**원본 구조:**
```
1. 서론 (500 토큰)
2. 선행연구
   2.1 국내 연구 (800 토큰)
   2.2 해외 연구 (900 토큰)
3. 연구방법
   3.1 실험 설계 (300 토큰)
   3.2 데이터 수집 (400 토큰)
```

**토큰 누적 과정** (max: 2,000 토큰):
1. "1. 서론" (500) → 청크 시작
2. "2.1 국내 연구" (800) → 누적 1,300
3. "2.2 해외 연구" (900) → 누적 2,200 초과!
   - 💡 같은 상위 섹션이지만 토큰 초과로 분리
   - 청크 1: "1. 서론" + "2. 선행연구" (헤더) + "2.1 국내연구" 내용
   - 청크 2: "2. 선행연구" (헤더) + "2.2 해외연구" 내용부터 새로 시작

#### 시나리오 4: 짧은 섹션들의 병합

**문서 내용:**
```
## 5. 참고사항
### 5.1 약어 (50 토큰)
### 5.2 용어 정의 (100 토큰)
### 5.3 단위 설명 (80 토큰)
### 5.4 기호 설명 (70 토큰)
```

**청킹 결과**:
- 각각이 너무 작아서 개별 청크로 만들면 비효율적
- 같은 "5. 참고사항" 아래 있고 합쳐도 300 토큰
- → **하나의 청크로 병합** (메타데이터: [5. 참고사항])

#### 청킹의 핵심 원칙

1. **의미 단위 우선**: 토큰 수보다 문서의 논리적 구조 우선
2. **표는 4,096 토큰까지 분할 안 함**: 표 데이터 무결성을 위해 4,096 토큰까지는 하나의 청크로 보존
3. **계층적 컨텍스트 보존**: 모든 청크에 상위 섹션 헤더들을 포함하여 완전한 문맥 경로 유지
4. **작은 조각 병합**: 50-100 토큰의 작은 섹션들은 관련 내용끼리 병합
5. **검색 최적화**: 사용자가 일부만 검색해도 전체 맥락을 찾을 수 있도록 메타데이터 강화

## 📋 전처리기 유형별 특징

### 적재용 전처리기
**목적**: 지식베이스 구축을 위한 정밀 분석

**특징**:
- ✅ Layout Detection으로 문서 구조 완벽 분석
- ✅ OCR을 통한 스캔 문서 처리
- ✅ 메타데이터 풍부하게 추출 (작성자, 날짜, 섹션 정보 등)

**적합한 문서**:
- 회사 규정, 매뉴얼
- 연구 보고서
- 법률 문서
- 기술 문서

### 첨부용 전처리기
**목적**: 빠른 참조를 위한 신속 처리

**특징**:
- ✅ 텍스트 중심의 빠른 추출
- ✅ 최소한의 구조 분석
- ✅ 대용량 문서 신속 처리
- ✅ 실시간 질의응답에 최적화

**적합한 문서**:
- 회의록
- 이메일 첨부파일
- 간단한 보고서
- FAQ 문서
